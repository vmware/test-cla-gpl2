# Auto-managed; DO NOT EDIT MANUALLY
# Stub Version: 9
name: CLA — Trigger Stub

on:
  pull_request_target:
    types: [opened, synchronize, reopened, ready_for_review]
  issue_comment:
    types: [created]

permissions:
  contents: read
  pull-requests: write
  issues: write
  statuses: write
  actions: read

concurrency:
  group: ${{ github.workflow }}-${{ github.event.pull_request.number || github.event.issue.number || github.run_id }}
  cancel-in-progress: true

jobs:
  guard:
    name: Gate & Decide
    runs-on: ubuntu-latest
    if: >
      ${{ github.event_name == 'pull_request_target' }} ||
      ${{ github.event_name == 'issue_comment' && github.event.issue.pull_request }}
    outputs:
      is_member: ${{ steps.member.outputs.is_member }}
    steps:
      - name: Short-circuit for org members (fast path)
        id: member
        uses: actions/github-script@v7
        with:
          script: |
            let isMember = false;
            try {
              await github.rest.orgs.checkMembershipForUser({
                org: context.repo.owner,
                username: context.payload.sender.login
              });
              isMember = true;
            } catch {}
            core.setOutput('is_member', isMember ? 'true' : 'false');

      - name: Skip if org member
        if: ${{ steps.member.outputs.is_member == 'true' }}
        run: echo "Org member — skipping CLA."

  call-cla:
    name: Call reusable CLA checker
    needs: guard
    if: ${{ needs.guard.outputs.is_member != 'true' }}
    uses: vmware/.github/.github/workflows/reusable-cla-check.yml@main
    with:
      allowlist_branch: "main"
      allowlist_path: "cla/allowlist.yml"
      sign_comment_exact: "I have read the CLA Document and I hereby sign the CLA"
    secrets:
      CONTRIBUTOR_ASSISTANT_PAT: ${{ secrets.CLA_ASSISTANT_PAT }}
